define(["jquery","eventDispatcher","ajaxConfig",newExperienceHeaderOn?"":"addProductShoppingBagFlyout",newExperienceHeaderOn?"":"savedItemsFlyout","savedItems","overlay","breakpoints","keysNavigation","configVariables","loader","riskified","numberly","csrfUpdate","gucciAuth","cookies"],function(a,e,n,t,i,o,r,d,l,c,s,u,p,f,T,g){function m(e){b.on("mouseover",function(){O.is(":empty")&&h(e)}),a(window).on("resize",function(){d.is("large")&&a(".mega-menu-slider-item-wrapper .img-cover").css("height","")}),a("body").on("confgiVariablesInitialized",function(){h(e)})}function h(e){a.ajax({url:I,type:"POST",dataType:"json",data:{CSRFToken:e}}).done(function(a){t.refreshMiniCart(a.data),"undefined"!=typeof pageType&&"PRODUCT"===pageType&&dataLayer.push({"cart token":a.data.order_token,"cart total":a.data.order_raw_total})})}function k(){g.unSet("oktaAccessToken")}function v(e){a.ajax({url:A,type:"POST",dataType:"json",data:{CSRFToken:e}}).done(function(a){t.miniCartCounter(a),t.handleClassesOnHeaderBag()})}function w(n){a.ajax({url:j,type:"POST",data:{CSRFToken:n},dataType:"html"}).done(function(n){var t=a("li#header-nav-user"),i="#header-nav-signin",o=t.length?t:a(i);o.each(function(){a(this).replaceWith(n)}),l.headerLoaded(),e.moduleLoading("headerMenuMobileAccount"),s.loadModules(a(i))})}function C(n){a.ajax({url:U,type:"POST",data:{CSRFToken:n},dataType:"html"}).done(function(t){a("li#header-nav-favorites").replaceWith(t),i.setFavoritesHeight(),o.fillSavedItems(n),e.moduleLoading("headerMenuMobileWishList"),a(window).trigger(F)})}function y(){a.ajax({url:x+"?key="+(new Date).getTime(),type:"GET",dataType:"json"}).done(function(e){"undefined"!=typeof e&&(window.LiveChatNamespace={user_logged:"true",firstName:e.firstName||null,lastname:e.lastName||null,uid:e.uid||null});var n=a('select[data-populate*="title"]');n.find('option[value="'+e.titleCode+'"]').length&&n.val(e.titleCode),a('input[data-populate*="first-name"]').val(e.firstName),a('input[data-populate*="last-name"]').val(e.lastName),e.firstNameKatakana&&a('input[data-populate*="first-name-katakana"]').val(e.firstNameKatakana),e.lastNameKatakana&&a('input[data-populate*="last-name-katakana"]').val(e.lastNameKatakana),a('input[data-populate*="email"]').val(e.uid);var t=e.firstName+" "+e.lastName;a('input[data-populate*="senderName"]').val(t),a('input[data-populate*="senderEmail"]').val(e.uid);var i=e.subscribedForNewsletter?"1":"0";a("select[data-populate]").trigger("change"),window.TroqTracking&&(TroqTracking.UserOptin=i,TroqTracking.UserEmail=e.uid,(window._troq||(window._troq=[])).push(["rtgoptin",TroqTracking.UserOptin]),TroqTracking._do_not_track_email||(window._troq||(window._troq=[])).push(["email",TroqTracking.UserEmail]),window.TroqTracking._track_on_load&&p.addScript()),"undefined"!=typeof GUCCI.user&&(GUCCI.user=a.extend({},GUCCI.user,e),GUCCI.user.isAuthenticated=!0),c.configInitialized(),window.TroqTracking&&(window.TroqTracking._track_on_load&&p.addScript(),window.TroqTracking._track_on_load=!1)}).error(function(){window.LiveChatNamespace={user_logged:"false",firstName:null,lastname:null,uid:null},k()})}function _(){a.ajax({url:P+"?key="+(new Date).getTime(),type:"GET",dataType:"html"}).done(function(e){e&&(r.open("#"+G),a(window).load(function(){a("#"+G+":visible")&&a("body").addClass("overlay-lock")}),a(".merging-basket-overlay-wrapper").html(e),require(["addMergedProductShoppingBag"],function(a){a.bindEvents()}))})}function N(){a.ajax({url:q,type:"GET",cache:!1}).done(function(e){if(e&&e.secToken){var n=e.secToken;a.ajaxPrefilter(function(a,e,t){for(var i=!1,o=["/shareProduct","/shareStore","/bookanappointment","contact/callback","Contact/callback","Contact/emailus","contact/emailus","/product-find-in-store.json","/store-item-email-endpoint.json","/ajax/subscribe","/saved-items-email-endpoint.json","/forgot-password.json","/pw/request","/ajax/email/sharewishlist","/gucci-places/save"],r=0;r<o.length;r++)if(a.url.indexOf(o[r])>-1){i=!0;break}i===!0&&(a.data+="&security_token=",a.data+=n,"&"===a.data.charAt(0)&&(a.data=a.data.substr(1)))})}u.beaconLoad(e)})}function S(){var e=hybris.contextPath+"/logout";a(document).on("click",'a[href="'+e+'"]',function(a){a.preventDefault(),f.clearCSRFTokenCache(),k(),T.closeSession(function(){location.href=e})})}function E(){T.init(window.authConfig)}var b=a("#header-nav-bag-wrapper"),O=b.find(".header-nav-child-bag-wrapper"),I=n.config["SHOPPING-BAG-MINI-CART"],A=n.config["SHOPPING-BAG-COUNT"],j=n.config["MY-ACCOUNT-FLYOUT-CONTENT"],U=n.config["SAVED-ITEMS-FLYOUT-CONTENT"],q=n.config.GET_SECURITY_TOKEN,x=n.config.CHECK_CUSTOMER_INFO,P=(n.config.GET_ASSISTANT_USER_INFO,n.config.GET_ASSISTANT_STORE_ACTIVATION,n.config.UPDATE_CART_MERGE_ENTRIES),G="merging-basket-overlay",F="saved-items-flyout.loaded";return{load:function(){E(),f.getToken().then(function(n){function i(){}var o=a("#header-nav-bag-wrapper").length>0;newExperienceHeaderOn!==!0&&(o&&(m(n),t.load(),v(n),w(n)),C(n)),S(),o&&(y(),_(n)),N(),e.dispatchAndListen("productPush",i)})},loadMyAccountFlyout:w,refreshMiniCart:h}});