define(["jquery","eventDispatcher","dispatcher","ajaxConfig","jsonHtml","loader","imageLoader","gucciJsonHtml","genericUtilities","csrfUpdate"],function(e,t,a,r,o,l,i,n,d,s){function c(){e(window).ready()&&e(".product-tiles-grid .ajax-loader-link").css({display:"inline-block"}).on("click",u)}function u(t){var a=e(this),r=a.attr("data-url");null==r&&(r=a.attr("href")),g(t),p(r,a.attr(v),a,a.attr(x))}function f(e){return decodeURIComponent(e)!==e}function p(t,r,d,s,c,u){var p=t,h=e("."+r),g=L+" "+w;l.updateElementClass(h,S,g),l.updateElementClass(d,S,g);var m="",v=d.attr("ID");"filterSortSelect"==v&&(t="product-tiles-grid-2");var x=T[t.toUpperCase()];if(x||(x=t),"looksGridLoadMoreLnk"==v){var U=d.attr(k),m="categoryCode="+d.attr(C),b=location.href.match(/.+sort=([^&]*)/i,"$1"),R=location.href.match(/.+filter=([^&]*)/i,"$1");null!=b&&(m+="&sort="+b[1]),null!=R&&(m+="&filter="+R[1]),null!=U&&(2==U?m+="&page=0&show=All":m=m+"&page="+U)}else if("productGridLoadAllLnk"==v){var U=d.attr(k),m="categoryCode="+d.attr(C),b=location.href.match(/.+sort=([^&]*)/i,"$1"),R=location.href.match(/.+filter=([^&]*)/i,"$1");null!=b&&(m+="&sort="+b[1]),null!=R&&(m+="&filter="+R[1]),m+="&page=0&show=All",e(".product-tiles-grid-item").removeClass("show-desktop")}else if("searchResultsLoadMoreLink"==v){var U=d.attr(k),N=d.attr(y),m="filter="+(f(N)?N:encodeURIComponent(N)),b=location.href.match(/.+sort=([^&]*)/i,"$1"),R=location.href.match(/.+filter=([^&]*)/i,"$1");null!=b&&(m+="&sort="+b[1]),null!=R&&(m+="&filter="+R[1]),null!=U&&(2==U?m+="&show=All&page=0":m=m+"&show=Page&page="+U)}else"filterSortSelect"==v?(m="categoryCode="+d.attr(C)+"&sort="+p,""!=e("#facetNavSelection").val()&&(m=m+"&filter="+e("#facetNavSelection").val())):"undefined"!=c&&""!=c&&null!=c?m="lookNumber="+c:("product-tiles-grid-3"==t||"product-tiles-grid-2"==t)&&(m="categoryCode="+d.attr(C)+"&filter=:"+e("select.sort-select").val()+":"+e("#facetNavSelection").val());m=m.replace(/[:(.?)]+:/g,":"),e.ajax({url:x,dataType:"json",data:m}).done(function(r){if(r="looks-detail"==t?[r,c]:r,-1!=t.indexOf("search-results-grid")||-1!=t.indexOf("product-tiles-grid")){var f=d.attr("data-componentName");j=n.compiler(r,t,d.attr(k),f)}else j=o.compiler(r,t);if("filterSortSelect"!=v&&"looks-detail"!=t&&"product-tiles-grid-3"!=t&&"product-tiles-grid-2"!=t&&(j.hideButton||"undefined"!=typeof d.attr("data-all-text")&&d.text().toUpperCase()==d.attr("data-all-text").toUpperCase()?d.hide():d.text(d.attr("data-all-text"))),"searchResultsLoadMoreLink"==v||"productGridLoadAllLnk"==v){var p=parseInt(d.attr(k));d.attr(k,p+1)}l.loadRepsonseInContainer(h,e(j.html),d,e("."+s)),i.loadImage(h),e("body").removeClass(A),"undefined"!=typeof u&&a.fireCallbacks(u,r)}).fail(function(){l.showLoadError(h,d)})}function h(t,a,o){var l=t.toUpperCase();return"undefined"===r.config[l]?(console.error("The Key ["+l+"] not exists into AJAX Config"),!1):(void 0==o&&(o="GET"),"POST"==o&&(a.CSRFToken=window.hybris.CSRFTokenUpdate.refreshCSRFToken()),e.ajax({url:r.config[l],type:o,data:a,dataType:"JSON",cache:!1,statusCode:{205:function(e,t,a){console.log("Session expired"),window.location.reload()}}}))}function g(e){e&&e.preventDefault&&e.preventDefault()}function m(t){var a={},r=t.serializeArray();return e.each(r,function(){void 0!==a[this.name]?(a[this.name].push||(a[this.name]=[a[this.name]]),a[this.name].push(this.value||"")):a[this.name]=this.value||""}),a}var v="data-load_container",C="data-catCode",k="data-pageNumber",y="data-searchText",x="data-load_remove_class",S="_loading",L="_loaded",w="_error",A="overlay-lock",j={},T=r.config;return{load:function(){function e(){}d.registerGridHandlebarsHelper(),c(),t.dispatchAndListen("ajaxLoader",e)},loadJson:p,endPointAccess:h,serializeObject:m}});