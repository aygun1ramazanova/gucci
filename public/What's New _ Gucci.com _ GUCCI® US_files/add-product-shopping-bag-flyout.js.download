define(["jquery","eventDispatcher","ajaxConfig","handlebars","header","configVariables","breakpoints","genericUtilities"],function(e,a,n,t,i,r,s,o){function c(){f.on("click",".js--close",function(){clearTimeout(I),i.closeNav(f)}),e(document).on("shopping-bag.add shopping-bag.remove",e.proxy(l)).on("touchmove",".header-nav-bag-list",function(){clearTimeout(I)}),f.on("mouseenter",function(){clearTimeout(I)})}function l(e,a){k||u(a.data,e)}function d(a){b.empty();var n=e(w(a));n.appendTo(b)}function u(e,a){h(e.items),e.user=GUCCI.user,d(e),p(),"remove"!==a.namespace&&v()}function h(e){if(e){for(var a=0,n=0;n<e.length;n++){var t=e[n];a+=t.quantity}m(a)}}function m(e){var a=e>0?e:"";y.html(a)}function p(){var a,n=f.find(".shopping-bag-product-count").text(),t=parseInt(n),i="header-nav-child-bag-empty",r="header-nav-child-bag-small",o="header-nav-child-bag-single",c="header-nav-parent-link-standard",l=e(".header-nav-child-bag",f);switch(a=isNaN(t)||""==t?0:t,f.removeClass(i),l.removeClass(c).removeClass(o).removeClass(r),a){case 0:f.addClass(i),!s.is("retina")&&s.is("standard")&&C.addClass(c);break;case 1:l.addClass(o),C.removeClass(c);break;case 2:l.addClass(r),C.removeClass(c);break;default:C.removeClass(c)}}function v(){clearTimeout(I),C.trigger("click"),I=setTimeout(function(){i.closeNav(f)},GUCCI.times.closeFlyOutWait)}function g(e){h(e.items),e.user=GUCCI.user,d(e),p()}var f=e("#header-nav-bag-wrapper"),C=e(".header-nav-parent-bag",f),b=e(".header-nav-child-bag-wrapper",f),y=e(".shopping-bag-product-count",f),k=e("#header-main-checkout").length>0,I=null;if(!k)var T=e("#shopping-bag-flyout-template").html(),w=t.compile(T);return t.registerHelper("userIsAuthenticated",function(e,a){return e.isAuthenticated===!0?a.inverse(this):a.fn(this)}),{load:function(){function e(){C.removeClass("inactive-module")}c(),a.dispatchAndListen("addProductShoppingBagFlyout",e)},handleClassesOnHeaderBag:function(){p()},refreshMiniCart:g,miniCartCounter:m,showFlyout:v,onItemsChangeHandler:l}});