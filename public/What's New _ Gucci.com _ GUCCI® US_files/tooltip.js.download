define(["jquery","eventDispatcher","breakpoints"],function(t,o,s){function e(){var o=C+"-hover",s=".tooltip-open",e=".tooltip-close";_.hasClass("no-touch")||_.hasClass("desktop")?y.on("mouseenter focus",o+":not(.tooltip_check)",n):_.hasClass("touch")&&y.on("click",o+":not(.tooltip_check)",n),y.on("click",s,a).on("click",e,u),t(window).on("resize",function(){t(o).removeClass("tooltip_check")}),y.on("click",o,function(t){t.preventDefault()}),y.on("click",function(o){var s=t(".tooltip-add-to-bag"),e=!1,a=!1;t(o.target).closest(".tooltip-close.add-to-bag-close").length&&(a=!0),s.each(function(){(t(this).is(t(o.target))||0!==t(this).has(t(o.target)).length)&&(e=!0,t(this).addClass(v))}),a===!0&&t(g).removeClass(v),e||(t("#calculate-tax").is(":visible")||t(g).removeClass(v),t(".ssa-discount-form--error").find("_active")&&t(".ssa-discount-form--error").removeClass(v))})}function a(o){o.stopPropagation(),o.preventDefault();var s=t(this),e=s.attr("href");void 0===e&&(e=s.data("href")),d(e),s.hasClass("saved-item-content-link-js tooltip-open")?s.siblings(e).addClass(v):t(e).addClass(v),_.hasClass("touch")&&_.on("click",h)}function n(o){o.stopPropagation(),o.preventDefault();var s=t(this),e=t(this).find(".tooltip"),a=s.parents(m).length||e.hasClass("tooltip-left");a?(e.offset({left:w}),r(s)):l(s)}function i(){var o=t("html").hasClass("tablet")&&t("body").hasClass("page-gucciCartPage","kr")&&!s.is("small");return o}function l(o){var s,e=o.find(".tooltip"),a=e.outerWidth(!0),n=e.offset().left-a/2,l=n+a,r=window.innerWidth,f=c(a,r);s=0>=n&&!t("body").hasClass("language-ar")?f:l>=r?r-a-f:i()?r-a-2*f:t("body").hasClass("language-ar")?l:n,e.offset({left:s}),o.addClass("tooltip_check")}function c(t,o){var s=t+w>=o;return s?(o-t)/2:w}function r(t){var o,s=t.find(".tooltip"),e=s.outerWidth(!0),a=s.offset().left+e,n=t.offset().left+t.outerWidth(!0);n>a&&(o=n+15,o-=e,s.offset({left:o})),t.addClass("tooltip_check")}function f(o){t(o).addClass(v)}function h(o){return t(o.target).parents(".tooltip").length?!1:(t(g).removeClass(v),void _.off("click",h))}function u(o){var s=t(this);s.hasClass("tooltip")?(k=s,b=s.parent()):k=s.closest(g),k.removeClass(v)}function d(o){var s,e;t(".tooltip._active").each(function(){s=t(this),e="#"+t(this).attr("id"),e!==o&&p(e)})}function p(o){t(o).removeClass(v)}var v="_active",C=".tooltip-open",g=".tooltip",m=".payment-module",k=null,b=null,_=t("html"),y=t("body"),w=_.hasClass("mobile")?10:30;return{load:function(){function t(){}e(),o.dispatchAndListen("tooltip",t)},open:function(t){f(t)},close:function(t){p(t)},closeAll:d}});