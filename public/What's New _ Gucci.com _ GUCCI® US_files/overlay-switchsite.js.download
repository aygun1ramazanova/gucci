define(["jquery","eventDispatcher","genericUtilities","breakpoints","cookies","header","overlay","os","gtmUtilities"],function(a,e,t,i,n,o,r,s,d){function c(){if(s.isInAppBrowser())return!1;var a=Boolean(n.get(p)),e=n.get(y);l(k,w,b,C)&&(u(e,a),a||n.set(p,!0)),n.set(y,n.get(g))}function l(a,e,t,i){var n=document.referrer,o=i.includes(t.toLowerCase());return n&&n.indexOf(a)>-1||e||o?!1:!0}function u(e,i){var o=a(".switchoverlay"),s=o.data("src_small"),c=o.data("src_small_retina"),l=o.data("src_medium"),u=o.data("src_medium_retina"),g=o.data("src_standard"),y=o.data("src_standard_retina"),h=o.data("bgopacity"),w="@media only screen and(max-width: 767px)",x="@media only screen and(max-width: 767px) and (-webkit-min-device-pixel-ratio: 2), (max-width: 767px) and (min-resolution: 192dpi)",C="@media only screen and(min-width: 768px) and (max-width: 1023px)",z="@media only screen and(min-width: 768px) and (max-width: 1023px) and (-webkit-min-device-pixel-ratio: 2), (min-width: 768px) and (max-width: 1023px) and (min-resolution: 192dpi)",L="@media only screen and(min-width: 1024px)",j="@media only screen and(min-width: 1024px) and (-webkit-min-device-pixel-ratio: 2), (min-width: 1024px) and (min-resolution: 192dpi)",S='<picture class="switch-overlay-bg"><source data-image-size="small-retina" data-srcset="'+c+'" media="'+x+'" srcset="'+c+'"><source data-image-size="medium-retina" data-srcset="'+u+'" media="'+z+'" srcset="'+u+'"><source data-image-size="standard-retina" data-srcset="'+y+'" media="'+j+'" srcset="'+y+'"><source data-image-size="small" data-srcset="'+s+'" media="'+w+'" srcset="'+s+'"><source data-image-size="medium" data-srcset="'+l+'" media="'+C+'" srcset="'+l+'"><source data-image-size="standard" data-srcset="'+g+'" media="'+L+'" srcset="'+g+'"><img data-image-type="fallback" class="'+h+'" data-srcset="'+g+'" alt="" srcset="'+g+'" data-was-processed="true"></picture>';o.length&&t.waitForCSRF(function(){a.ajax({url:a("body").data("switchsite")+"?cookie="+e,data:{cachekill:Math.floor(101*Math.random())*(new Date).getTime()},success:function(e){if(e){var t=e.replace('<div class="international-content-wrapper overlay-wrapper">','<div class="international-content-wrapper overlay-wrapper">'+S),s=a(t).find(".countrylist").data("countrylist").split("_").join('"'),c=a(t).find(".countrylistlang").data("countrylistlang").split("-").join('"'),l=JSON.parse(s),u=JSON.parse(c),g=a(t).data("cookiecountry"),y="",h=a(t).data("detectediso"),w=u[h.toLowerCase()],x=a(t).data("istransactionalgeocountry");g&&"undefined"!=typeof g&&(y=l[g.toUpperCase()]),f=-1!==t.indexOf('data-originalcountry="int"'),f&&g&&(t=t.replace(/data-detectediso=\"[a-zA-Z]{0,9}\" /,'data-detectediso="'+g+'"'),t=t.replace(/<span class="countryName">[a-zA-Z\s\S]*<\/span>/,'<span class="countryName">'+y+"</span>"));var C=a(t).data("detectediso").toLowerCase()?a(t).data("detectediso").toLowerCase():"int";C="gb"===C?"uk":C,C="in"===C?"int":C;a(t).data("detectedisolanguage").toLowerCase()?a(t).data("detectedisolanguage").toLowerCase():"";if(!w&&!g)return;a("#page").append(t);var z=a(t).data("reason");v="CN"==a(t).data("detectediso"),(!i||v||f&&x)&&o.length&&(r.open(m),dataLayer.push({event:"overlay.open",vpvel:"overlay-localization",trigger:z})),i&&v&&n.unSet(p,!0),a(".international-overlay-close, .continue-to").on("click",function(){r.close(m)}),_[3]=C,_[4]=u[C];var L=_.join("/").indexOf("?")>-1,j=L?"&":"?",O=_.join("/")+j+"utm_medium=geolocation&utm_source=gucci-"+b+"&utm_campaign=overlay",N=a(".white-button");N.on("click",function(){d.safeGTMuaEventsPusher("countrySelection","country selection","click on country selector overlay",C)}),a.ajax({url:O,success:function(){N.attr("href",O)},error:function(){j="?",O="https://"+k+"/"+C+"?utm_medium=geolocation&utm_source=gucci-"+b+"&utm_campaign=overlay",N.attr("href",O)}})}},error:function(a){console.log("error-data"),console.log(a)}})})}var m="#international-overlay",p="g_geooverlay",g="site_abbreviation",y="g_geooverlay_siteabbreviation",h=a("body"),w=h.hasClass("page-gucciCartPage")||h.hasClass("page-checkout")||h.hasClass("page-GucciOrderConfirmationPage")||h.hasClass("page-checkout-login"),v=!1,f=!1,x=window.location.href,_=x.split("/"),b=_[3],k=window.location.hostname,C=[];return{load:function(){function a(){c()}e.dispatchAndListen("overlaySwitchsite",a)}}});