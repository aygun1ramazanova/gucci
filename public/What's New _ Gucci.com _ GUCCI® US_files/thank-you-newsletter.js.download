define(["jquery","eventDispatcher","formEndpointValidation","ajaxConfig","overlay","os","imageLoader","configVariables","forms"],function(e,t,a,n,r,o,i,l,d){function s(){e(".newsletter-button-wrapper .js--form-validation-button").on("click.validation",u),e("body").on("confgiVariablesInitialized",function(e){"undefined"!=typeof GUCCI.user&&GUCCI.user.uid&&(h=GUCCI.user.uid)}),d.initValidation(k),k.on("submit",u),T.on("submit",m),T.prop("action",p),a.newInstance(T,f,f),i.loadImage(T),e("select",T).on("change",c)}function c(){var t=e(this),a=t.val(),n=a>0||isNaN(a);n?t.removeClass("gold"):t.addClass("gold")}function u(t){e(".newsletter-button-wrapper .js--form-validation-button").attr("disabled",!0),t.preventDefault();var a=e("#email-updates"),n=a.closest("form"),o=a.val(),i=a.data("reference"),l=e("#"+i).val();if("undefined"==typeof a.data("placeholder")&&a.data("placeholder",a.attr("placeholder")),o){var s={email:o,CSRFToken:hybris.CSRFToken};s[i]=l,e(".newsletter-privacy").each(function(){s[this.getAttribute("name")]=this.value});var c=e.ajax({url:g,type:v,data:jQuery.param(s),dataType:"json"});c.done(function(t){T.find(".error-text").remove(),T.find(".tooltip-message error-text").remove(),T.find(".error").removeClass("error").attr("aria-invalid","false"),e("input:text",T).val(""),e("#email-updates",k).val(h),e("select",T).find('option[value="0"]').prop("selected",!0),e("input:checkbox",T).not("checked-at-default").removeAttr("checked"),e(".checked-at-default",T).prop("checked",!0),t.data.hide?e("#thank-you-newsletter").addClass("no-form"):e("#thank-you-newsletter").removeClass("no-form"),r.open("#thank-you-newsletter"),e(".newsletter-email").text(o),e(".newsletter-email-input").val(o),n.removeClass("newsletter-invalid-email-error"),d.disableFieldValidation(a),a.val(h),a.blur(),d.enableFieldValidation(a,n),a.attr("placeholder",a.data("placeholder")),window.TroqTracking&&(TroqTracking.UserOptin="1",TroqTracking.UserEmail=o,window._troq=window._troq||[],_troq.push(["tagid",TroqTracking.tagid],["_rtgpg","completedform"],["_rtgidform","sign"],["_rtgoptin",TroqTracking.UserOptin],["_rtglanguage",TroqTracking.rtglanguage],["_rtgidcountry",TroqTracking.rtgidcountry],["_email",TroqTracking.UserEmail]))}),c.error(function(){})}}function f(e){e&&"ok"==e.status&&r.close("#thank-you-newsletter")}function m(){f()}var p=n.config["THANK-YOU-NEWSLETTER"],g=n.config["SIGN-UP-UPDATES"],v=n.mainSubmitMethod,h=(n.config.CHECK_CUSTOMER_INFO,""),k=e("#thank-you-newsletter-form"),T=e("#thank-you-newsletter-overlay");return{load:function(){function a(){e("#thank-you-newsletter-form").removeClass("inactive-module")}s(),t.dispatchAndListen("thankYouNewsletter",a)}}});