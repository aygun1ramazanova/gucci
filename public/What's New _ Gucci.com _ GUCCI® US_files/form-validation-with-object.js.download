define(["jquery","eventDispatcher"],function(e,t){function r(e,t){this.$form=e,this.fieldErrorFormat=t||"inline",this.preventSubmit=!1,this.bindEvents()}function i(e,i){function n(){}return t.dispatchAndListen("formValidationWithObject",n),new r(e,i)}var n=".error-message",s="error-text",o="error-text-no-ajax",a="tooltip-help",d="tooltip-help-no-ajax",l="tooltip-message error-text",u="error";e("html").hasClass("touch");return r.prototype.bindEvents=function(){this.$form.on("submit",e.proxy(this.submitHandler,this))},r.prototype.submitHandler=function(e){var t;this.preventSubmit||(this.$form.find('input[required="required"]').length>0&&(e.preventDefault(),t=this.$form.find("input.input-login-email").length>0||this.$form.find("input.input-login-pwd").length>0?GUCCI.userMessages.loginError:GUCCI.userMessages.required,this.findRequiredField(t)),this.$form.find(".error").length>0||(this.$form.find("input[data-validation-match]").length>0&&(e.preventDefault(),t=GUCCI.userMessages.match,this.findMatchField(t)),0===this.$form.find(".error").length&&(this.preventSubmit=!0,this.formSuccess())))},r.prototype.findRequiredField=function(t){var r=this,i=this.$form,n=[];i.find('input[required="required"]').each(function(){var o,d=e(this);i.find('input[required="required"]').length>1&&i.find('input[required="required"]').last()!==d;d.removeClass(u).attr("aria-invalid","false"),d.next("."+s).remove(),d.next("."+a).remove(),""===e.trim(d.val())&&(o=r.getFieldErrorMessage(d,t),r.appendFieldErrorMessage(d,o,t),n.push(d))}),n.length&&n[0].focus()},r.prototype.findMatchField=function(t){var r,i,n=this,o=this.$form,d=[];o.find("input[data-validation-match]").each(function(){r=e(this),r.removeClass(u).attr("aria-invalid","false"),r.next("."+s).remove(),r.next("."+a).remove(),r.val()!==e('input[name="'+r.data("validation-match")+'"]').val()&&(i=n.getFieldErrorMessage(r,t),n.appendFieldErrorMessage(r,i,t),d.push(r))}),d.length&&d[0].focus()},r.prototype.appendFieldErrorMessage=function(e,t,r){focus||!0;e.is("select")?(e.addClass(u).attr("aria-invalid","true"),this.addErrorMessage(e,t,r)):(e.is("input")||e.is("textarea"))&&(e.addClass(u).attr("aria-invalid","true"),this.addErrorMessage(e,t,r))},r.prototype.addErrorMessage=function(e,t,r){this.findErrorMessage()?e.after(t):this.putErrorMessage(r)},r.prototype.findErrorMessage=function(){return 0===this.$form.find(n).length},r.prototype.getFieldErrorMessage=function(e,t){var r;switch(this.fieldErrorFormat){case"tooltip":r=this.getFieldErrorMessageTooltip(e,t);break;case"inline":r=this.getFieldErrorMessageInline(e,t);break;default:r=this.getFieldErrorMessageInline(e,t)}return r},r.prototype.getFieldErrorMessageInline=function(t,r){return e("<span>").addClass(s+" "+o+" "+n).html(r)},r.prototype.getFieldErrorMessageTooltip=function(t,r){var i=e("<div>"),s=e("<div>");return i.addClass(a+" "+d+" "+n),s.addClass(l),s.html(r),i.append(s),i},r.prototype.putErrorMessage=function(e){var t=this.$form;t.find(n).html(e)},r.prototype.formSuccess=function(){this.$form.submit()},{newFormValidate:i}});